{% extends 'common/base.html' %}


{% block extra_style %}
<style>
    #div-result-form.edit {
        border: 3px solid #dd4145;
    }
    #div-result-form.success {
        border: 3px solid #28a745;
    }
    #div-result-form.empty {
        border: 3px solid #6c757d;
    }
    #div-result-form.edit span.badge-danger {
        display: inline-block!important;
    }
    #div-result-form.success .badge-success {
        display: inline-block!important;
    }
    #div-result-form.empty .badge-secondary  {
        display: inline-block!important;
    }
    #div-result-form.empty input, #div-result-form.empty textarea {
        border:1px solid #6c757d;
    }
    #div-result-form.success input, #div-result-form.success textarea {
        border:1px solid #28a745;
    }
    #div-result-form.edit input, #div-result-form.edit textarea {
        border:1px solid #dd4145;
    }
</style>
{% endblock %}


{% block header_back_button %}
    <a class="navbar-brand plit-color" href="{% url 'judge:apparatus-list' object.competition.pk %}">
        <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
        width="24" height="24"
        viewBox="0 0 172 172"
        style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><g fill="#49a0ac"><path d="M71.15783,86l27.38383,-27.38383c2.967,-2.967 2.967,-7.783 0,-10.75v0c-2.967,-2.967 -7.783,-2.967 -10.75,0l-33.067,33.067c-2.80217,2.80217 -2.80217,7.33867 0,10.13367l33.067,33.067c2.967,2.967 7.783,2.967 10.75,0v0c2.967,-2.967 2.967,-7.783 0,-10.75z"></path></g></g></svg>
        к списку
    </a>
{% endblock %}


{% block body %}
    <div class="col-12">
        <div class="row">
            <div class="col-12 text-center mb-2 p-2 text-white h3" id="team">
                {% if temp.temp_team %}
                {{ temp.temp_team.name }}
                {% else %}
                    Команды нет
                {% endif %}
            </div>
            <div class="col-12 p-4  my-2 h3 text-center" id="gymnast">
                    <span class="badge badge-light" style="color:#33879b!important;" id="gymnast-span">
                        {% if temp.temp_gymnast %}
                            {{ temp.temp_gymnast.get_competition_name }}
                        {% else %}
                            Гимнаста нет
                        {% endif %}
                    </span>
            </div>
        <div class="col-12 p-3" id="result-form">
            <div class="mrow">
                <div id="div-result-form" class="col-12 col-lg-6 offset-lg-3 col-md-6 offset-md-3 bg-white shadow rounded p-3 {% if mark_d.value %}success{% else %}empty{% endif %}">
                    <div class="row">
                        <div class="col-12 text-right">
                            <span class="badge badge-secondary" style="display:none;border: 2px solid #000;">
                                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
                                width="50" height="50"
                                viewBox="0 0 172 172"
                                style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><g><path d="M157.66667,86c0,39.57433 -32.09233,71.66667 -71.66667,71.66667c-39.57433,0 -71.66667,-32.09233 -71.66667,-71.66667c0,-39.57433 32.09233,-71.66667 71.66667,-71.66667c39.57433,0 71.66667,32.09233 71.66667,71.66667z" fill="#000000"></path><path d="M86,28.66667c-31.72683,0 -57.33333,25.6065 -57.33333,57.33333c0,31.72683 25.6065,57.33333 57.33333,57.33333c31.72683,0 57.33333,-25.6065 57.33333,-57.33333c0,-31.72683 -25.6065,-57.33333 -57.33333,-57.33333z" fill="#ffffff"></path></g></g></svg>
                            </span>
                            <span class="badge badge-success" style="display:none">
                                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
                                width="50" height="50"
                                viewBox="0 0 172 172"
                                style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><g fill="#ffffff"><path d="M86,6.88c-43.6552,0 -79.12,35.4648 -79.12,79.12c0,43.6552 35.4648,79.12 79.12,79.12c43.6552,0 79.12,-35.4648 79.12,-79.12c0,-43.6552 -35.4648,-79.12 -79.12,-79.12zM86,13.76c39.9368,0 72.24,32.3032 72.24,72.24c0,39.9368 -32.3032,72.24 -72.24,72.24c-39.9368,0 -72.24,-32.3032 -72.24,-72.24c0,-39.9368 32.3032,-72.24 72.24,-72.24zM120.35969,51.55969c-1.13486,0.02237 -2.18564,0.60307 -2.80844,1.55203l-35.09203,51.72765l-25.08109,-23.27375c-0.89676,-0.8629 -2.18961,-1.17423 -3.38088,-0.81414c-1.19126,0.36009 -2.09519,1.33544 -2.36381,2.5506c-0.26862,1.21516 0.13995,2.48065 1.06843,3.30932l30.94656,28.71594l39.60031,-58.35906c0.74064,-1.06125 0.82307,-2.44836 0.21333,-3.58986c-0.60974,-1.1415 -1.8085,-1.84425 -3.10239,-1.81873z"></path></g></g></svg>
                            </span>
                            <span class="badge badge-danger edited" style="display:none;">
                                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
                                width="50px" height="50px"
                                viewBox="0 0 172 172"
                                style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><g fill="#ffffff"><path d="M129.26245,9.28027c-2.78198,0 -5.56396,1.00781 -7.60059,3.04443l-11.39038,11.40088c-2.09961,-2.09961 -5.51147,-2.09961 -7.60059,0l-15.20117,15.20117c-1.01831,1.01831 -1.58521,2.37256 -1.58521,3.81079c0,1.42773 0.5669,2.78198 1.58521,3.78979l0.12598,0.13647l-72.77246,72.65698c-1.35425,1.35425 -2.1731,3.14941 -2.33057,5.06006l-1.81616,22.5603l-1.88965,13.22754c-0.12598,0.83984 0.15747,1.67969 0.76636,2.28858c0.50391,0.50391 1.18628,0.77685 1.88965,0.77685c0.13647,0 0.26245,0 0.38843,-0.02099l13.21704,-1.87915l22.69678,-1.67969c1.93164,-0.13647 3.7373,-0.96582 5.10205,-2.33057l72.77246,-72.66748c0.99731,0.93433 2.27808,1.45923 3.65332,1.45923c1.43823,0 2.78198,-0.5564 3.80029,-1.57471l15.20117,-15.20117c2.09961,-2.09961 2.09961,-5.50098 0,-7.60059l11.41138,-11.40088c2.02612,-2.03662 3.13892,-4.73462 3.13892,-7.61108c0,-2.86597 -1.11279,-5.57446 -3.14941,-7.60059l-22.80176,-22.80176c-2.02613,-2.03662 -4.8186,-3.04443 -7.61109,-3.04443zM129.26245,14.60278c1.39624,0 2.79248,0.50391 3.81079,1.52222l22.80176,22.80176c1.01831,1.01831 1.57471,2.36206 1.57471,3.80029c0,1.43823 -0.5564,2.79248 -1.57471,3.80029l-11.40088,11.41138l-30.41284,-30.41284l11.41138,-11.40088c1.00781,-1.01831 2.40405,-1.52222 3.78979,-1.52222zM106.46069,27.52588l1.91065,1.90015l34.20264,34.20264l1.90015,1.91065l-3.80029,3.78979c-1.0498,-1.0498 -2.75049,-1.0498 -3.80029,0l-3.80029,3.81079c-1.0498,1.0498 -1.0498,2.75049 0,3.80029l-3.80029,3.80029l-38.01343,-38.01343l3.80029,-3.80029c0.5249,0.5249 1.20728,0.78735 1.90015,0.78735c0.69287,0 1.37524,-0.26245 1.90015,-0.78735l3.81079,-3.80029c1.0498,-1.0498 1.0498,-2.75049 0,-3.80029zM110.27148,40.03955c-0.69287,0 -1.37524,0.26245 -1.90015,0.78735l-3.81079,3.80029c-1.0498,1.0498 -1.0498,2.75049 0,3.80029c0.5249,0.5249 1.21777,0.78735 1.90015,0.78735c0.69287,0 1.38574,-0.26245 1.91065,-0.78735l3.78979,-3.80029c1.0603,-1.0498 1.0603,-2.75049 0,-3.80029c-0.5249,-0.5249 -1.20728,-0.78735 -1.88965,-0.78735zM119.76172,49.55078c-0.68237,0 -1.36474,0.25195 -1.88965,0.78735l-3.81079,3.78979c-1.0498,1.0603 -1.0498,2.75049 0,3.81079c0.5249,0.5144 1.21777,0.77685 1.91065,0.77685c0.68237,0 1.37524,-0.26245 1.90015,-0.77685l3.78979,-3.81079c1.0603,-1.0498 1.0603,-2.73999 0,-3.78979c-0.5249,-0.5354 -1.20727,-0.78735 -1.90015,-0.78735zM91.40649,50.46411l30.40234,30.41284l-70.67285,70.55737l-2.56152,-12.80762l44.58521,-44.5852c1.0498,-1.0498 1.0498,-2.75049 0,-3.80029c-1.0498,-1.0498 -2.73999,-1.0498 -3.80029,0l-44.5957,44.5957l-6.33032,-1.27026l-1.27026,-6.34082l36.99512,-36.98462c1.0603,-1.0603 1.0603,-2.75049 0,-3.81079c-1.0498,-1.0498 -2.73999,-1.0498 -3.78979,0l-36.99512,36.99512l-12.53467,-2.49853zM129.27295,59.04102c-0.69287,0 -1.37524,0.26245 -1.90015,0.79785l-3.80029,3.78979c-1.0498,1.0603 -1.0498,2.75049 0,3.81079c0.5249,0.5144 1.20728,0.78735 1.90015,0.78735c0.69287,0 1.37524,-0.27295 1.90015,-0.78735l3.80029,-3.81079c1.0498,-1.0498 1.0498,-2.73999 0,-3.78979c-0.5249,-0.5354 -1.20728,-0.79785 -1.90015,-0.79785zM87.46973,70.45239c-0.69287,0 -1.37524,0.26245 -1.90015,0.77685l-7.60059,7.60059c-1.0603,1.0603 -1.0603,2.75049 0,3.81079c0.5144,0.5144 1.20728,0.78735 1.90015,0.78735c0.68237,0 1.37524,-0.27295 1.88965,-0.78735l7.60059,-7.60059c1.0603,-1.0603 1.0603,-2.75049 0,-3.81079c-0.5249,-0.5249 -1.20728,-0.78735 -1.88965,-0.77685zM17.7627,125.7876l14.20386,2.83447l1.54321,7.75806c0.22046,1.0603 1.0498,1.88965 2.11011,2.09961l7.74756,1.55371l2.86597,14.34033l-20.4502,1.50122l-9.6582,-9.64771z"></path></g></g>
                                </svg>
                            </span>
                        </div>
                        <div class="col-12 my-2">
                            <input type="number" max="9.9" step="0.01" class="form-control" placeholder="Оценка" value="{{ mark_d.value }}" id="value">
                        </div>
                        <div class="col-12">
                            <hr style="background-color: #b0b0b0;width:100%;">
                        </div>
                        <div class="col-12">
                            <label for="comment">
                                Комментарий
                            </label>
                            <textarea class="form-control" cols="10" rows="3" id="comment" placeholder="комментарий">
                                {{ mark_d.comment }}
                            </textarea>
                        </div>
                        <div class="col-12 text-center mt-3">
                            <button id="save-button" class="btn btn-lg btn-warning">Сохранить</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>
{% endblock %}



{% block scripts %}
    {{ block.super }}
<script type="text/javascript">
function setGymnastName (name){
    $('#gymnast span').html(name)
}
$(function(){
    $('#value').keydown(function(){
        $('#div-result-form').removeClass('success').removeClass('empty').removeClass('edit')
        if ($(this).val() == '') {
            $('#div-result-form').addClass('empty')
        } else {
            $('#div-result-form').addClass('edit')
        }
    })
    $('#save-button').click(function (){
        let data = {
            value: $('#value').val(),
            comment: $('#comment').val()
        }
        data = JSON.stringify(data)
        $.ajax({
          type: "POST",
          url: '{% url "judge:apparatus-d" object.pk %}',
          data: data,
          success: function (response) {
              console.log(response)
            if (response.status === 200) {
                $('#div-result-form').removeClass('edit')
                $('#div-result-form').addClass('success')
            } else {
                alert('Error ! Status ' + response.status)
            }
          },
          dataType: 'json'
        });
    })
})
$(document).ready(function (){
    setInterval(function (){
        $.get('{% url 'judge:apparatus-d' object.pk %}', function(data){
            console.log(data)
            if (data.temp) {
                console.log(data.temp)
                if (data.temp.gymnast) {
                    $('#gymnast-span').html(data.temp.gymnast)
                }
                if (data.temp.team) {
                    $('#team').html(data.temp.team)
                }
            }
        })
    }, 5000)
})
</script>
{% endblock %}